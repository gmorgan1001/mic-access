<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat with AI</title>
    <style>
        /* Styles for chatbot overlay */
        #chatbot-container {
            position: fixed;
            right: 0;
            top: 0;
            width: 350px;
            height: 100vh;
            background: white;
            box-shadow: -3px 0px 10px rgba(0,0,0,0.2);
            border-left: 1px solid #ccc;
            z-index: 10000;
        }
        #chatbot-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        /* Close button - White "X" in top-right */
        #close-chat {
            position: absolute;
            top: 10px;
            right: 10px;
            background: transparent;
            color: black;
            font-size: 24px;
            font-weight: bold;
            border: none;
            cursor: pointer;
            outline: none;
        }
    </style>
</head>
<body>

    <div id="chatbot-container">
        <button id="close-chat" onclick="document.getElementById('chatbot-container').style.display='none'">âœ–</button>
        <iframe id="chatbot-iframe" src="https://connxr.com/tutor"></iframe>
    </div>

    <script>
        // Function to add permissions to the iframe
        function addPermissions(iframe) {
            const ALLOW_PERMISSIONS = 'camera *; microphone *; autoplay *; encrypted-media *; fullscreen *; display-capture *;';
            if (iframe.allow === ALLOW_PERMISSIONS) {
                return;
            }
            iframe.setAttribute('allow', ALLOW_PERMISSIONS);
            iframe.allow = ALLOW_PERMISSIONS;
            iframe.src = iframe.src;
        }

        // Apply permissions to the chatbot iframe
        document.querySelectorAll('iframe').forEach(addPermissions);

        // Observe if new iframes are added and apply permissions
        const observer = new MutationObserver(function(mutationsList) {
            for (let mutation of mutationsList) {
                if (mutation.addedNodes && mutation.addedNodes.length) {
                    for (let node of mutation.addedNodes) {
                        if (node.querySelectorAll) {
                            node.querySelectorAll('iframe').forEach(addPermissions);
                        }
                    }
                }
            }
        });

        observer.observe(document.body, { attributes: false, childList: true, subtree: true });

        // Prevent overscroll on mobile devices
        document.addEventListener("DOMContentLoaded", function () {
            let lastY = 0;

            document.addEventListener("touchstart", function(event) {
                lastY = event.touches[0].clientY;
            });

            document.addEventListener("touchmove", function(event) {
                let scrollTop = window.scrollY || document.documentElement.scrollTop;
                let maxScroll = document.documentElement.scrollHeight - window.innerHeight;

                if ((scrollTop <= 0 && event.touches[0].clientY > lastY) || 
                    (scrollTop >= maxScroll && event.touches[0].clientY < lastY)) {
                    event.preventDefault();
                }
                lastY = event.touches[0].clientY;
            }, { passive: false });

            // Apply CSS to fully prevent overscroll
            let style = document.createElement("style");
            style.innerHTML = `
                html, body {
                    overscroll-behavior: none !important;
                    touch-action: pan-y !important;
                }
            `;
            document.head.appendChild(style);
        });
    </script>

</body>
</html>
